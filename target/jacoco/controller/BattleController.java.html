<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="hu"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>BattleController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">game</a> &gt; <a href="index.source.html" class="el_package">controller</a> &gt; <span class="el_source">BattleController.java</span></div><h1>BattleController.java</h1><pre class="source lang-java linenums">package controller;
import javafx.animation.FadeTransition;
import javafx.application.Platform;
import javafx.event.ActionEvent;
import javafx.event.EventHandler;
import javafx.fxml.FXML;
import javafx.fxml.FXMLLoader;
import javafx.fxml.Initializable;

import javafx.scene.Parent;
import javafx.scene.Scene;
import javafx.scene.control.Button;
import javafx.scene.control.ProgressBar;

import javafx.scene.control.TextField;
import javafx.scene.image.Image;
import javafx.scene.image.ImageView;

import javafx.scene.layout.AnchorPane;

import javafx.scene.paint.Color;

import javafx.scene.text.Font;
import javafx.scene.text.Text;
import javafx.stage.Stage;
import javafx.util.Duration;

import modell.Enemy;
import modell.Player;

import java.io.IOException;
import java.net.URL;

import java.util.Random;
import java.util.ResourceBundle;

import java.util.concurrent.Executors;
import java.util.concurrent.ScheduledExecutorService;
import java.util.concurrent.TimeUnit;

<span class="nc" id="L41">public class BattleController implements Initializable{</span>


<span class="nc" id="L44">    Player player = new Player(WellcomeSceneController.NAME);</span>
<span class="nc" id="L45">    Enemy enemy = new Enemy();</span>


<span class="nc" id="L48">    ScheduledExecutorService exec = Executors.newSingleThreadScheduledExecutor();</span>
<span class="nc" id="L49">    Random random = new Random();</span>

<span class="nc" id="L51">    double opaci = 1.0;</span>


    private static final String MEDIA_URL =
            &quot;http://download.oracle.com/otndocs/products/javafx/oow2010-2.flv&quot;;

    @FXML
    private Button previousLvlButton;

    @FXML
    private TextField yourMoney;

    @FXML
    private ProgressBar hpBar;

    @FXML
    private Text enemyHpText;

    @FXML
    private Button backButton;

    @FXML
    private Button nextButton;

    @FXML
    private Button hitButton;

    @FXML
    private Text lvlText;

    @FXML
    private AnchorPane rootPane;

    @FXML
    private Text dmgText;

    @FXML
    private ImageView mobImage;
    @FXML
    void Hit(ActionEvent event) {
<span class="nc" id="L91">        attack();</span>
<span class="nc" id="L92">    }</span>

    @FXML
    void previousLvlButtonClick(ActionEvent event) {

<span class="nc bnc" id="L97" title="All 2 branches missed.">        if(enemy.getLvl()&gt;=2){</span>
<span class="nc" id="L98">                opaci=1.0;</span>
<span class="nc" id="L99">                hpBar.setProgress(opaci);</span>
<span class="nc" id="L100">                enemy.setMaxHp(enemy.getMaxHp()-400);</span>
                //enemyMaxHp-=400;
<span class="nc" id="L102">                enemy.setHp(enemy.getMaxHp());</span>
                //enemyHp = enemyMaxHp;
<span class="nc" id="L104">                enemyHpText.setText(&quot;&quot;+format(enemy.getHp())+&quot; / &quot;+format(enemy.getMaxHp()));</span>
<span class="nc" id="L105">                enemy.setLvl(enemy.getLvl()-1);</span>
                //lvl--;
<span class="nc" id="L107">                lvlText.setText(&quot;&quot;+enemy.getLvl());</span>

        }
<span class="nc" id="L110">    }</span>

    @FXML
    void nextLvlButtonClick(ActionEvent event) {

<span class="nc bnc" id="L115" title="All 2 branches missed.">                if (enemy.getLvl() &lt; player.getLvl()) {</span>

<span class="nc" id="L117">                        opaci = 1.0;</span>
<span class="nc" id="L118">                        hpBar.setProgress(opaci);</span>
<span class="nc" id="L119">                        enemy.setMaxHp(enemy.getMaxHp() + 400);</span>
                        //enemyMaxHp+=400;
<span class="nc" id="L121">                        enemy.setHp(enemy.getMaxHp());</span>
                        //enemyHp = enemyMaxHp;
<span class="nc" id="L123">                        enemyHpText.setText(&quot;&quot; + format(enemy.getHp()) + &quot; / &quot; + format(enemy.getMaxHp()));</span>
                        //lvl++;
<span class="nc" id="L125">                        enemy.setLvl(enemy.getLvl()+1);</span>
<span class="nc" id="L126">                        lvlText.setText(&quot;&quot; + enemy.getLvl());</span>

                }

<span class="nc" id="L130">    }</span>


    @FXML
    void backButtonClick(ActionEvent event) throws IOException {
<span class="nc" id="L135">        makeFadeTrans(1,0);</span>
        try{
<span class="nc" id="L137">            exec.shutdown();</span>
<span class="nc" id="L138">        }catch(Exception e){</span>
<span class="nc" id="L139">            System.out.println(e);</span>
<span class="nc" id="L140">        }</span>


<span class="nc" id="L143">    }</span>

    private void loadNextScene(){
        try{
<span class="nc" id="L147">            Parent newGameViewParent = FXMLLoader.load(getClass().getResource(&quot;/fxml/Character.fxml&quot;));</span>
<span class="nc" id="L148">            Scene newGameViewScene = new Scene(newGameViewParent);</span>

<span class="nc" id="L150">            Stage window = (Stage) rootPane.getScene().getWindow();</span>

<span class="nc" id="L152">            window.setScene(newGameViewScene);</span>
<span class="nc" id="L153">            window.show();</span>
<span class="nc" id="L154">        }catch(IOException ex){</span>
<span class="nc" id="L155">            System.out.println(&quot;Could open the next fxml! &quot;+ex);</span>
<span class="nc" id="L156">        }</span>

<span class="nc" id="L158">    }</span>
    void winCheck(int currentHp){

<span class="nc bnc" id="L161" title="All 2 branches missed.">        if(currentHp &lt;= 0){</span>

<span class="nc bnc" id="L163" title="All 2 branches missed.">            if(player.getResetCount()&gt;0){</span>
<span class="nc" id="L164">                player.setMoney((int)(player.getMoney()+(50*((double)enemy.getLvl()/2))*(player.getResetCount()+1)));</span>
            }else{
<span class="nc" id="L166">                player.setMoney((int)(player.getMoney()+(50*((double)enemy.getLvl()/2))));</span>
            }
<span class="nc bnc" id="L168" title="All 2 branches missed.">            if(enemy.getLvl()!=player.getLvl()){</span>
                try{
<span class="nc" id="L170">                    int random = (int )(Math.random() * 3 + 1);</span>

<span class="nc" id="L172">                    Image image = new Image(getClass().getResource(&quot;/Images/Mob&quot;+random+&quot;.png&quot;).toExternalForm());</span>

                    //mobImage.setImage(image);
<span class="nc" id="L175">                    mobImage.setImage(image);</span>
<span class="nc" id="L176">                }catch(Exception e){</span>
<span class="nc" id="L177">                    System.out.println(&quot;Could open the image file!: &quot;+e);</span>
<span class="nc" id="L178">                }</span>

<span class="nc" id="L180">                enemy.setHp(enemy.getMaxHp());</span>
<span class="nc" id="L181">                enemyHpText.setText(&quot;&quot;+format(enemy.getHp())+&quot; / &quot;+format(enemy.getMaxHp()));</span>
            }else{
                try{
<span class="nc" id="L184">                    int random = (int )(Math.random() * 3 + 1);</span>

                    /*System.out.println(&quot;Images/Mob&quot;+random+&quot;.png&quot;);
                    Image image = new Image(&quot;Images/Mob&quot;+random+&quot;.png&quot;);*/
                    //mobImage.setImage(image);
<span class="nc" id="L189">                    Image image = new Image(getClass().getResource(&quot;/Images/Mob&quot;+random+&quot;.png&quot;).toExternalForm());</span>
<span class="nc" id="L190">                    mobImage.setImage(image);</span>


                    //mobImage.setImage(new Image(getClass().getResource(&quot;Images/Mob&quot;+random+&quot;.png&quot;).toExternalForm()));
<span class="nc" id="L194">                }catch(Exception e){</span>
<span class="nc" id="L195">                    System.out.println(&quot;Could open the image file!: &quot;+e);</span>
<span class="nc" id="L196">                }</span>
<span class="nc" id="L197">                enemy.setHp(enemy.getMaxHp()+400);</span>
<span class="nc" id="L198">                enemy.setMaxHp(enemy.getHp());</span>
<span class="nc" id="L199">                enemyHpText.setText(&quot;&quot;+format(enemy.getHp())+&quot; / &quot;+format(enemy.getMaxHp()));</span>
<span class="nc" id="L200">                enemy.setLvl(enemy.getLvl()+1);</span>
<span class="nc bnc" id="L201" title="All 2 branches missed.">                if(enemy.getLvl()&gt;player.getLvl()){</span>
<span class="nc" id="L202">                    player.setLvl(enemy.getLvl());</span>
                }
<span class="nc" id="L204">                lvlText.setText(&quot;&quot;+enemy.getLvl());</span>
            }

<span class="nc" id="L207">            yourMoney.setText(&quot;&quot;+format(player.getMoney())+&quot;G&quot;);</span>
<span class="nc bnc" id="L208" title="All 2 branches missed.">            if((double)enemy.getHp()/enemy.getMaxHp()&gt;0){</span>
<span class="nc" id="L209">                opaci = (double)enemy.getHp()/enemy.getMaxHp();</span>
            }else{
<span class="nc" id="L211">                opaci = 0;</span>
            }
<span class="nc" id="L213">            hpBar.setProgress(opaci);</span>
<span class="nc" id="L214">            player.save();</span>

        }
<span class="nc" id="L217">    }</span>

    private void bossTimer(){

<span class="nc" id="L221">        System.out.println(&quot;boss: &quot;+30+&quot; s&quot;);</span>

<span class="nc" id="L223">    }</span>

    private String format(int number){
<span class="nc" id="L226">        double result = number;</span>
<span class="nc bnc" id="L227" title="All 2 branches missed.">        if(number/1000&gt;0){</span>
<span class="nc" id="L228">            return &quot;&quot;+result/1000+&quot;k &quot;;</span>
        }
<span class="nc" id="L230">        return &quot;&quot;+result;</span>
    }

    void attack() {


<span class="nc bnc" id="L236" title="All 2 branches missed.">            if(random.nextInt(100) &lt;= player.getCritical()){</span>
<span class="nc" id="L237">                enemy.setHp(enemy.getHp()-player.getDmg()*player.getCriticalDmg());</span>
<span class="nc bnc" id="L238" title="All 2 branches missed.">                if((double)enemy.getHp()/enemy.getMaxHp()&gt;0){</span>
<span class="nc" id="L239">                    opaci = (double)enemy.getHp()/enemy.getMaxHp();</span>
                }else{
<span class="nc" id="L241">                    opaci = 0;</span>
                }
<span class="nc" id="L243">                dmgText.setOpacity(0);</span>
<span class="nc" id="L244">                dmgText.setFont(Font.font(42));</span>
<span class="nc" id="L245">                dmgText.setFill(Color.ORANGE);</span>

<span class="nc" id="L247">                dmgText.setText(&quot;&quot;+format(player.getDmg()*player.getCriticalDmg())+&quot; Hit&quot;);</span>

<span class="nc" id="L249">                makeFadeTrandText();</span>
            }else{
<span class="nc" id="L251">                enemy.setHp(enemy.getHp()-player.getDmg());</span>
<span class="nc bnc" id="L252" title="All 2 branches missed.">                if((double)enemy.getHp()/enemy.getMaxHp()&gt;0){</span>
<span class="nc" id="L253">                    opaci = (double)enemy.getHp()/enemy.getMaxHp();</span>
                }else{
<span class="nc" id="L255">                    opaci = 0;</span>
                }
<span class="nc" id="L257">                dmgText.setOpacity(0);</span>
<span class="nc" id="L258">                dmgText.setFill(Color.RED);</span>
<span class="nc" id="L259">                dmgText.setFont(Font.font(32));</span>

<span class="nc" id="L261">                dmgText.setText(&quot;&quot;+format(player.getDmg())+&quot; Hit&quot;);</span>


<span class="nc" id="L264">                makeFadeTrandText();</span>
            }

<span class="nc" id="L267">            opaci = (double)enemy.getHp()/enemy.getMaxHp();</span>
<span class="nc" id="L268">            hpBar.setProgress(opaci);</span>

<span class="nc" id="L270">            enemyHpText.setText(&quot;&quot;+format(enemy.getHp())+&quot; / &quot;+format(enemy.getMaxHp()));</span>

<span class="nc" id="L272">            winCheck(enemy.getHp());</span>

<span class="nc" id="L274">    }</span>
    void AiAttack(){

<span class="nc" id="L277">        enemy.setHp(enemy.getHp()-player.getAiDmg());</span>
<span class="nc bnc" id="L278" title="All 2 branches missed.">        if((double)enemy.getHp()/enemy.getMaxHp()&gt;0){</span>
<span class="nc" id="L279">            opaci = (double)enemy.getHp()/enemy.getMaxHp();</span>
        }else{
<span class="nc" id="L281">            opaci = 0;</span>
        }


<span class="nc" id="L285">        hpBar.setProgress(opaci);</span>


<span class="nc" id="L288">        dmgText.setOpacity(0);</span>
<span class="nc" id="L289">        dmgText.setFont(Font.font(42));</span>
<span class="nc" id="L290">        dmgText.setFill(Color.BLUE);</span>

<span class="nc" id="L292">        dmgText.setText(&quot;&quot;+format(player.getAiDmg())+&quot; Hit&quot;);</span>

<span class="nc" id="L294">        makeFadeTrandText();</span>



<span class="nc" id="L298">        enemyHpText.setText(&quot;&quot;+format(enemy.getHp())+&quot; / &quot;+format(enemy.getMaxHp()));</span>

<span class="nc" id="L300">        winCheck(enemy.getHp());</span>
<span class="nc" id="L301">    }</span>
    private void makeFadeTrans(int start, int end){
<span class="nc" id="L303">        FadeTransition fadeTransition = new FadeTransition();</span>
<span class="nc" id="L304">        fadeTransition.setDuration(Duration.millis(1000));</span>
<span class="nc" id="L305">        fadeTransition.setNode(rootPane);</span>
<span class="nc" id="L306">        fadeTransition.setFromValue(start);</span>
<span class="nc" id="L307">        fadeTransition.setToValue(end);</span>
<span class="nc bnc" id="L308" title="All 2 branches missed.">        if(end &lt; start){</span>
<span class="nc" id="L309">            fadeTransition.setOnFinished(new EventHandler&lt;ActionEvent&gt;() {</span>
                public void handle(ActionEvent event) {
<span class="nc" id="L311">                    loadNextScene();</span>
<span class="nc" id="L312">                }</span>
            });
        }
<span class="nc" id="L315">        fadeTransition.play();</span>
<span class="nc" id="L316">    }</span>
    private void makeFadeTrandText(){
<span class="nc" id="L318">        FadeTransition fadeTransition = new FadeTransition();</span>
<span class="nc" id="L319">        fadeTransition.setDuration(Duration.millis(1000));</span>
<span class="nc" id="L320">        fadeTransition.setNode(dmgText);</span>
<span class="nc" id="L321">        fadeTransition.setFromValue(1);</span>
<span class="nc" id="L322">        fadeTransition.setToValue(0);</span>
<span class="nc" id="L323">        fadeTransition.play();</span>
<span class="nc" id="L324">    }</span>
    public void initialize(URL url, ResourceBundle rb){
<span class="nc" id="L326">        enemy.setLvl(player.getLvl());</span>
<span class="nc" id="L327">        Platform.setImplicitExit(false);</span>

<span class="nc" id="L329">        exec.scheduleAtFixedRate(new Runnable() {</span>

            public void run() {
<span class="nc" id="L332">                Platform.runLater(new Runnable() {</span>
                    public void run() {
<span class="nc" id="L334">                        AiAttack();</span>
<span class="nc" id="L335">                    }</span>
                });

<span class="nc" id="L338">            }</span>
        }, 0, 500,  TimeUnit.MILLISECONDS);

<span class="nc" id="L341">        makeFadeTrans(0,1);</span>
<span class="nc" id="L342">        lvlText.setText(&quot;&quot;+enemy.getLvl());</span>
<span class="nc" id="L343">        yourMoney.setText(&quot;&quot;+format(player.getMoney())+&quot;G&quot;);</span>
<span class="nc" id="L344">        enemy.setHp(enemy.getLvl()*400);</span>
<span class="nc" id="L345">        enemy.setMaxHp(enemy.getHp());</span>

<span class="nc" id="L347">        enemyHpText.setText(&quot;&quot;+format(enemy.getHp())+&quot; / &quot;+format(enemy.getMaxHp()));</span>


<span class="nc" id="L350">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.1.201803210924</span></div></body></html>